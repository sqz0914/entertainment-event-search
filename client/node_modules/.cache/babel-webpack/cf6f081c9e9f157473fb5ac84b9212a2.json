{"ast":null,"code":"import _asyncToGenerator from \"/Users/sqz0914/Desktop/CSCI-571/hw8/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { FormControl, Validators } from '@angular/forms';\nimport axios from 'axios';\nlet AppComponent = class AppComponent {\n  constructor(eventsSearch, fb) {\n    this.eventsSearch = eventsSearch;\n    this.fb = fb;\n    this.zoom = 12;\n    this.marker = {};\n    this.options = {\n      mapTypeId: 'roadmap',\n      zoomControl: true,\n      scrollwheel: true,\n      disableDoubleClickZoom: false\n    };\n    this.IPINFO_API_KEY = \"34404dccf051af\";\n    this.venue = {};\n    this.fetchUserLocation = false;\n    this.emptyKeyword = false;\n    this.invalidKeyword = false;\n    this.emptyInputLocation = false;\n    this.enableDetailButton = false;\n    this.noEventsRecord = false;\n    this.eventsSearchError = false;\n    this.eventDetailSearchError = false;\n    this.artistSearchError = false;\n    this.venueSearchError = false;\n    this.recordResultsTabClick = true;\n    this.recordFavoriteTabClick = false;\n    this.userLat = '';\n    this.userLng = '';\n    this.categories = ['All', 'Music', 'Sports', 'Arts & Theatre', 'Film', 'Miscellaneous'];\n    this.units = ['Miles', 'Kilometers'];\n    this.events = [];\n    this.eventDetail = {};\n    this.artistDetail = [];\n    this.venueDetail = {};\n    this.searchForm = this.fb.group({\n      keyword: new FormControl('', [Validators.required, forbiddenKeywordValidator(/(^[ ]+$)/)]),\n      category: new FormControl(''),\n      distance: new FormControl('10'),\n      unit: new FormControl(''),\n      location: new FormControl('here'),\n      inputLocation: new FormControl({\n        value: '',\n        disabled: true\n      })\n    });\n    this.searchForm.controls.category.setValue('All', {\n      onlySelf: true\n    });\n    this.searchForm.controls.unit.setValue('Miles', {\n      onlySelf: true\n    });\n    this.center = {\n      lat: 30,\n      lng: -110\n    };\n  }\n\n  enableLocationInput() {\n    this.searchForm.controls.inputLocation.enable();\n    this.searchForm.controls.inputLocation.setValidators([Validators.required]);\n    this.searchForm.controls.inputLocation.updateValueAndValidity();\n  }\n\n  disableLocationInput() {\n    this.searchForm.controls.inputLocation.disable();\n  }\n\n  ngOnInit() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      let theURL = 'https://ipinfo.io/?token=' + _this.IPINFO_API_KEY;\n      let result = yield axios.get(theURL);\n      let userLoc = result.data.loc.split(',');\n      _this.userLat = userLoc[0];\n      _this.userLng = userLoc[1];\n      _this.fetchUserLocation = true;\n    })();\n  }\n\n  onSubmit() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a, _b, _c; // TODO: Use EventEmitter with form value\n\n\n      if (_this2.searchForm.valid) {\n        _this2.emptyKeyword = false;\n        _this2.invalidKeyword = false;\n        _this2.emptyInputLocation = false;\n        _this2.eventsSearchError = false;\n        _this2.noEventsRecord = false;\n        let formValues = _this2.searchForm.value;\n        let keyword = formValues.keyword;\n        let category = processCategory(formValues.category);\n        let distance = formValues.distance;\n        let unit = processUnit(formValues.unit);\n        let location = formValues.location;\n\n        if (location == 'here') {\n          try {\n            _this2.events = yield _this2.eventsSearch.getLocalEvents(keyword, category, distance, unit, _this2.userLat, _this2.userLng);\n          } catch (error) {\n            _this2.eventsSearchError = true;\n          }\n        } else {\n          let locationText = formValues.inputLocation;\n\n          try {\n            _this2.events = yield _this2.eventsSearch.getEvents(keyword, category, distance, unit, locationText);\n          } catch (error) {\n            _this2.eventsSearchError = true;\n          }\n        }\n\n        if (_this2.events.length === 0) {\n          _this2.noEventsRecord = true;\n        }\n      } else {\n        if ((_a = _this2.searchForm.controls.keyword.errors) === null || _a === void 0 ? void 0 : _a.required) {\n          _this2.emptyKeyword = true;\n          _this2.invalidKeyword = false;\n        }\n\n        if ((_b = _this2.searchForm.controls.keyword.errors) === null || _b === void 0 ? void 0 : _b.forbiddenKeyword) {\n          _this2.invalidKeyword = true;\n          _this2.emptyKeyword = false;\n        }\n\n        if ((_c = _this2.searchForm.controls.inputLocation.errors) === null || _c === void 0 ? void 0 : _c.required) {\n          _this2.emptyInputLocation = true;\n        }\n      }\n    })();\n  }\n\n  searchEventDetail(eventId) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      _this3.eventDetail = {};\n      _this3.artistDetail = [];\n      _this3.venueDetail = {};\n      _this3.enableDetailButton = true;\n      _this3.eventDetailSearchError = false;\n      _this3.artistSearchError = false;\n      _this3.venueSearchError = false;\n\n      try {\n        _this3.eventDetail = yield _this3.eventsSearch.getEventDetail(eventId); // console.log(this.eventDetail);\n      } catch (error) {\n        _this3.eventDetailSearchError = true;\n      }\n\n      if (_this3.eventDetail.hasOwnProperty('artistTeam')) {\n        let artistTeamList = _this3.eventDetail.artistTeam.split('|');\n\n        try {\n          for (const artist of artistTeamList) {\n            let result = yield _this3.eventsSearch.getArtistInfo(artist);\n            let artistInfo = {\n              'name': artist,\n              'info': result\n            };\n\n            _this3.artistDetail.push(artistInfo);\n          }\n        } catch (error) {\n          console.log(error);\n          _this3.artistSearchError = true;\n        }\n      }\n\n      if (_this3.eventDetail.hasOwnProperty('venue')) {\n        let venueName = _this3.eventDetail.venue;\n\n        try {\n          _this3.venueDetail = yield _this3.eventsSearch.getVenueDetail(venueName); // console.log(this.venueDetail);\n        } catch (error) {\n          console.log(error);\n          _this3.venueSearchError = true;\n        }\n      }\n\n      if (_this3.venueDetail.hasOwnProperty('lat') && _this3.venueDetail.hasOwnProperty('lng')) {\n        let venueLat = parseFloat(_this3.venueDetail.lat);\n        let venueLng = parseFloat(_this3.venueDetail.lng);\n        _this3.center = {\n          lat: venueLat,\n          lng: venueLng\n        };\n        _this3.marker = {\n          position: {\n            lat: _this3.center.lat,\n            lng: _this3.center.lng\n          },\n          label: {\n            color: 'red'\n          }\n        };\n      }\n    })();\n  }\n\n  isEmptyObj(obj) {\n    return Object.keys(obj).length === 0;\n  }\n\n};\nAppComponent = __decorate([Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.css'],\n  styles: []\n})], AppComponent);\nexport { AppComponent };\n\nfunction forbiddenKeywordValidator(keywordRe) {\n  return control => {\n    const forbidden = keywordRe.test(control.value);\n    return forbidden ? {\n      forbiddenKeyword: {\n        value: control.value\n      }\n    } : null;\n  };\n}\n\nfunction processCategory(category) {\n  let categoryForSearch;\n\n  if (category === 'Music') {\n    categoryForSearch = 'music';\n  } else if (category === 'Sports') {\n    categoryForSearch = 'sports';\n  } else if (category === 'Arts & Theatre') {\n    categoryForSearch = 'arts';\n  } else if (category === 'Film') {\n    categoryForSearch = 'film';\n  } else if (category === 'Miscellaneous') {\n    categoryForSearch = 'miscellaneous';\n  } else {\n    categoryForSearch = 'all';\n  }\n\n  return categoryForSearch;\n}\n\nfunction processUnit(unit) {\n  let unitForSearch;\n\n  if (unit === 'Kilometers') {\n    unitForSearch = 'km';\n  } else {\n    unitForSearch = 'miles';\n  }\n\n  return unitForSearch;\n}","map":{"version":3,"sources":["/Users/sqz0914/Desktop/CSCI-571/hw8/client/src/app/app.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit, ViewChild } from '@angular/core';\nimport { FormGroup, FormControl, FormBuilder, Validators, AbstractControl, ValidatorFn, ValidationErrors } from '@angular/forms';\nimport { EventsSearchService } from './service/events-search.service';\nimport axios from 'axios';\nimport * as $ from 'jquery';\n\n@Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.css']\n})\n\nexport class AppComponent implements OnInit{\n  zoom = 12\n  marker: any = {}\n  center: google.maps.LatLngLiteral\n  options: google.maps.MapOptions = {\n    mapTypeId: 'roadmap',\n    zoomControl: true,\n    scrollwheel: true,\n    disableDoubleClickZoom: false\n  }\n\n  IPINFO_API_KEY = \"34404dccf051af\";\n  venue = {};\n  fetchUserLocation: boolean = false;\n  emptyKeyword: boolean = false;\n  invalidKeyword: boolean = false;\n  emptyInputLocation: boolean = false;\n  enableDetailButton: boolean = false;\n  noEventsRecord: boolean = false;\n  eventsSearchError: boolean = false;\n  eventDetailSearchError: boolean = false;\n  artistSearchError: boolean = false;\n  venueSearchError: boolean = false;\n  recordResultsTabClick: boolean = true;\n  recordFavoriteTabClick: boolean = false;\n  userLat = '';\n  userLng = '';\n  searchForm: FormGroup;\n  categories: string[] = ['All', 'Music', 'Sports', 'Arts & Theatre', 'Film', 'Miscellaneous'];\n  units: string[] = ['Miles', 'Kilometers'];\n\n  constructor(public eventsSearch: EventsSearchService, public fb: FormBuilder){\n    this.searchForm = this.fb.group({\n      keyword: new FormControl('', [\n        Validators.required,\n        forbiddenKeywordValidator(/(^[ ]+$)/)\n      ]),\n      category: new FormControl(''),\n      distance: new FormControl('10'),\n      unit: new FormControl(''),\n      location: new FormControl('here'),\n      inputLocation: new FormControl({value: '', disabled: true}),\n    })\n    this.searchForm.controls.category.setValue('All', {onlySelf: true});\n    this.searchForm.controls.unit.setValue('Miles', {onlySelf: true});\n    this.center = {\n        lat: 30,\n        lng: -110,\n    } \n  }\n\n  enableLocationInput(){\n    this.searchForm.controls.inputLocation.enable();\n    this.searchForm.controls.inputLocation.setValidators([Validators.required]);\n    this.searchForm.controls.inputLocation.updateValueAndValidity();\n  }\n\n  disableLocationInput(){\n    this.searchForm.controls.inputLocation.disable();\n  }\n\n  async ngOnInit() {\n    let theURL = 'https://ipinfo.io/?token=' + this.IPINFO_API_KEY;\n    let result = await axios.get(theURL);\n    let userLoc = result.data.loc.split(',');\n    this.userLat = userLoc[0];\n    this.userLng = userLoc[1];\n    this.fetchUserLocation = true;\n  }\n  \n  events: any[] = [];\n\n  async onSubmit() {\n    // TODO: Use EventEmitter with form value\n    if(this.searchForm.valid){\n      this.emptyKeyword = false;\n      this.invalidKeyword = false;\n      this.emptyInputLocation = false;\n      this.eventsSearchError = false;\n      this.noEventsRecord = false;\n\n      let formValues = this.searchForm.value;\n      let keyword = formValues.keyword;\n      let category = processCategory(formValues.category);\n      let distance = formValues.distance;\n      let unit = processUnit(formValues.unit);\n      let location = formValues.location;\n\n      if(location == 'here'){\n        try{\n          this.events = await this.eventsSearch.getLocalEvents(keyword, category, distance, unit, this.userLat, this.userLng);\n        } catch(error){\n          this.eventsSearchError = true;\n        }\n      }\n      else{\n        let locationText = formValues.inputLocation;\n        try{\n          this.events = await this.eventsSearch.getEvents(keyword, category, distance, unit, locationText);\n        } catch(error){\n          this.eventsSearchError = true;\n        }\n      }\n      if(this.events.length === 0){\n        this.noEventsRecord = true;\n      }\n    }\n    else{\n      if(this.searchForm.controls.keyword.errors?.required){\n        this.emptyKeyword = true;\n        this.invalidKeyword = false;\n      }\n      if(this.searchForm.controls.keyword.errors?.forbiddenKeyword){\n        this.invalidKeyword = true;\n        this.emptyKeyword = false;\n      }\n      if(this.searchForm.controls.inputLocation.errors?.required){\n        this.emptyInputLocation = true;\n      }\n    }\n  }\n\n  eventDetail: any = {};\n  artistDetail: any[] = [];\n  venueDetail: any = {};\n\n  async searchEventDetail(eventId: string){\n    this.eventDetail = {};\n    this.artistDetail = [];\n    this.venueDetail = {};\n    this.enableDetailButton = true;\n    this.eventDetailSearchError = false;\n    this.artistSearchError = false;\n    this.venueSearchError = false;\n    \n    try{\n      this.eventDetail = await this.eventsSearch.getEventDetail(eventId);\n      // console.log(this.eventDetail);\n    } catch(error){\n      this.eventDetailSearchError = true;\n    }\n    if(this.eventDetail.hasOwnProperty('artistTeam')){\n      let artistTeamList = this.eventDetail.artistTeam.split('|');\n      try{\n        for(const artist of artistTeamList){\n          let result = await this.eventsSearch.getArtistInfo(artist);\n          let artistInfo = {'name': artist, 'info': result};\n          this.artistDetail.push(artistInfo);\n        }\n      } catch(error){\n        console.log(error);\n        this.artistSearchError = true;\n      }\n    }\n    if(this.eventDetail.hasOwnProperty('venue')){\n      let venueName = this.eventDetail.venue;\n      try{\n        this.venueDetail = await this.eventsSearch.getVenueDetail(venueName);\n        // console.log(this.venueDetail);\n      } catch(error){\n        console.log(error);\n        this.venueSearchError = true;\n      }\n    }\n    if(this.venueDetail.hasOwnProperty('lat') && this.venueDetail.hasOwnProperty('lng')){\n      let venueLat = parseFloat(this.venueDetail.lat);\n      let venueLng = parseFloat(this.venueDetail.lng);\n      this.center = {\n        lat: venueLat,\n        lng: venueLng\n      }\n      this.marker = {\n        position: {\n          lat: this.center.lat,\n          lng: this.center.lng,\n        },\n        label: {\n          color: 'red',\n        },\n      }\n    }\n  }\n\n  isEmptyObj(obj: any) {\n    return Object.keys(obj).length === 0;\n  }\n}\n\nfunction forbiddenKeywordValidator(keywordRe: RegExp): ValidatorFn {\n  return (control: AbstractControl): ValidationErrors | null => {\n    const forbidden = keywordRe.test(control.value);\n    return forbidden ? {forbiddenKeyword: {value: control.value}} : null;\n  };\n}\n\nfunction processCategory(category: string){\n  let categoryForSearch;\n  if(category === 'Music'){\n    categoryForSearch = 'music';\n  } else if(category === 'Sports'){\n    categoryForSearch = 'sports';\n  } else if(category === 'Arts & Theatre'){\n    categoryForSearch = 'arts';\n  } else if(category === 'Film'){\n    categoryForSearch = 'film';\n  } else if(category === 'Miscellaneous'){\n    categoryForSearch = 'miscellaneous';\n  } else{\n    categoryForSearch = 'all';\n  }\n  return categoryForSearch;\n}\n\nfunction processUnit(unit: string){\n  let unitForSearch;\n  if(unit === 'Kilometers'){\n    unitForSearch = 'km';\n  } else{\n    unitForSearch = 'miles';\n  }\n  return unitForSearch;\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}